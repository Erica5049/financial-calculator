<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ç†è´¢è®¡ç®—å™¨ - Day4 ç¾åŒ–ç‰ˆ</title>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Roboto+Mono&display=swap" rel="stylesheet">
<style>
:root{
  --primary:#007a3d;
  --primary-light:#00a050;
  --bg:#f5f7fa;
  --card:#ffffff;
  --text:#1d1d1f;
  --text-light:#6e6e73;
  --radius:12px;
  --shadow:0 4px 16px rgba(0,0,0,.08);
  --font-main:'Inter',sans-serif;
  --font-mono:'Roboto Mono',monospace;
  --breakpoint-sm:576px;
  --breakpoint-md:768px;
  --breakpoint-lg:992px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);font-family:var(--font-main);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:1rem}
.container{max-width:720px;width:100%}
h1{text-align:center;margin-bottom:2rem;font-weight:600}
/* å“åº”å¼ Tabs */
.tabs{display:flex;gap:.5rem;margin-bottom:1.5rem}
.tab{flex:1;text-align:center;padding:.75rem;border-radius:var(--radius);background:#e7e7eb;font-weight:600;cursor:pointer;transition:.3s}
.tab.active{background:var(--primary);color:#fff}
/* å¡ç‰‡ */
.card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:1.5rem;margin-bottom:1.5rem}
label{display:block;margin-bottom:.75rem;font-weight:600;color:var(--text)}
input[type=number],select{width:100%;padding:.75rem;border:1px solid #d1d1d6;border-radius:var(--radius);font-size:1rem;font-family:var(--font-main)}
input[type=number]:focus,select:focus{outline:none;border-color:var(--primary)}
button{width:100%;padding:.875rem;border:none;border-radius:var(--radius);background:var(--primary);color:#fff;font-size:1rem;font-weight:600;cursor:pointer;transition:background .3s}
button:hover{background:var(--primary-light)}
/* ç»“æœåŠ¨ç”» */
#resultCard{opacity:0;transform:translateY(20px);transition:opacity .4s,transform .4s}
#resultCard.show{opacity:1;transform:none}
.report h2{margin-bottom:1rem;color:var(--primary)}
.report p{line-height:1.6;margin-bottom:.5rem}
.highlight{background:#eafff1;padding:1rem;border-left:4px solid var(--primary);border-radius:var(--radius);margin:1rem 0}
.contact-form{margin-top:1.5rem;border-top:1px dashed #ccc;padding-top:1.5rem}
.contact-form input{margin-bottom:1rem}
/* å¾®åŠ¨ç”» */
@keyframes pulse{50%{transform:scale(1.05)}}
button:active{animation:pulse .2s}
/* å“åº”å¼ Grid */
@media(min-width:var(--breakpoint-md)){
  .inputs-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
}
@media(min-width:var(--breakpoint-lg)){
  .layout{display:grid;grid-template-columns:1fr 1fr;gap:2rem}
}
</style>
<!-- Google Analyticsï¼ˆåŸ‹ç‚¹ï¼‰ -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'GA_MEASUREMENT_ID');
  // é€šç”¨åŸ‹ç‚¹å‡½æ•°
  function track(event, payload = {}) {
    gtag('event', event, payload);
  }
</script>
</head>
<body>
<div class="container">
  <h1>ç†è´¢è®¡ç®—å™¨ - Day4 ç¾åŒ–ç‰ˆ</h1>

  <!-- å“åº”å¼ Tabs -->
  <div class="tabs">
    <div class="tab active" data-mode="simple">ç®€å•ç‰ˆ</div>
    <div class="tab" data-mode="complex">å¤æ‚ç‰ˆ</div>
  </div>

  <!-- è¾“å…¥åŒº -->
  <div class="card">
    <form id="calcForm">
      <div id="inputs" class="inputs-grid"></div>
      <button type="submit">å¼€å§‹è®¡ç®—</button>
    </form>
  </div>

  <!-- ç»“æœåŒº -->
  <div id="resultCard" class="card hidden">
    <div id="report" class="report"></div>
    <!-- å¤æ‚ç‰ˆç•™èµ„ -->
    <div id="contactForm" class="contact-form hidden">
      <h3>è·å–ä¸“å±ç†è´¢æ–¹æ¡ˆ</h3>
      <input type="email" id="email" placeholder="é‚®ç®±" required>
      <input type="tel" id="phone" placeholder="ç”µè¯" required>
      <button id="sendBtn" type="button">ç«‹å³è·å–</button>
    </div>
  </div>
</div>

<script>
/* ---------- å·¥å…· ---------- */
const $ = id => document.getElementById(id);
const tabs = document.querySelectorAll('.tab');
let mode = 'simple';

/* ---------- æ¸²æŸ“è¾“å…¥ï¼ˆå“åº”å¼ Gridï¼‰ ---------- */
function buildUI(m){
  const i = $('inputs');
  i.innerHTML = m==='simple'
  ? `
    <label>è´·æ¬¾é‡‘é¢ Â¥<input name="amount" type="number" value="100000" step="10000" required></label>
    <label>å¹´åˆ©ç‡ %<input name="rate" type="number" step="0.01" value="5.99" required></label>
    <label>æœŸé™ï¼ˆæœˆï¼‰<input name="term" type="number" value="36" required></label>
    <label>è¿˜æ¬¾æ–¹å¼
      <select name="method">
        <option value="equalInterest">ç­‰é¢æœ¬æ¯</option>
        <option value="equalPrincipal">ç­‰é¢æœ¬é‡‘</option>
        <option value="equalInterestPrincipal">ç­‰æœ¬ç­‰æ¯</option>
        <option value="interestOnly">å…ˆæ¯åæœ¬</option>
      </select>
    </label>
  `
  : `
    <label>å¹´æ”¶å…¥ Â¥<input name="income" type="number" value="300000" step="10000" required></label>
    <label>å¹´æ”¯å‡º Â¥<input name="expense" type="number" value="120000" step="10000" required></label>
    <label>ç›®æ ‡é‡‘é¢ Â¥<input name="target" type="number" value="1000000" step="10000" required></label>
    <label>æŠ•èµ„å¹´é™ï¼ˆå¹´ï¼‰<input name="years" type="number" value="10" required></label>
    <label>é¢„æœŸé€šèƒ€ %<input name="inflation" type="number" step="0.1" value="2.5"></label>
    <label>é£é™©æ‰¿å—åŠ›
      <select name="risk">
        <option value="low">ä¿å®ˆ</option>
        <option value="medium" selected>ç¨³å¥</option>
        <option value="high">è¿›å–</option>
      </select>
    </label>
  `;
}
tabs.forEach(t=>t.onclick=()=>{
  tabs.forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  mode = t.dataset.mode;
  buildUI(mode);
  $('resultCard').classList.remove('show','hidden');
  $('contactForm').classList.add('hidden');
});

/* ---------- è®¡ç®— ---------- */
function calcLoan(amount, annualRate, term, method){
  const r = annualRate / 100 / 12;
  let monthly, interest, firstMonth, lastMonth;
  switch(method){
    case 'equalInterest':
      monthly = amount * r * Math.pow(1+r, term) / (Math.pow(1+r, term) - 1);
      interest = monthly * term - amount;
      firstMonth = lastMonth = monthly;
      break;
    case 'equalPrincipal':
      const principalPerMonth = amount / term;
      const firstInterest = amount * r;
      const lastInterest  = principalPerMonth * r;
      firstMonth = principalPerMonth + firstInterest;
      lastMonth  = principalPerMonth + lastInterest;
      interest   = (amount * r + lastInterest) * term / 2;
      monthly    = 'é€æœˆé€’å‡';
      break;
    case 'equalInterestPrincipal':
      interest = amount * annualRate / 100 * (term/12);
      monthly  = (amount + interest) / term;
      firstMonth = lastMonth = monthly;
      break;
    case 'interestOnly':
      monthly = amount * r;
      interest = monthly * term;
      firstMonth = monthly;
      lastMonth  = monthly + amount;
      break;
  }
  return {monthly, interest, firstMonth, lastMonth};
}
function calcComplex(fd){
  const {income,expense,target,years,inflation,risk}=fd;
  const annualSave = income-expense;
  const realRate = ({low:0.04,medium:0.06,high:0.08}[risk]-inflation/100);
  const pvTarget = target/Math.pow(1+realRate,years);
  const gap = pvTarget-annualSave*((Math.pow(1+realRate,years)-1)/realRate);
  const needMonthly = gap>0?gap*realRate/((Math.pow(1+realRate,years)-1))/12:0;
  return {annualSave,needMonthly,realRate,income,expense,target,years,risk};
}

/* ---------- é£é™©-é…ç½®-è¡ŒåŠ¨è”åŠ¨ ---------- */
const riskMap = {
  low:{name:'ä¿å®ˆå‹',bond:'70â€“80',index:'15â€“25',equity:'0â€“5',rebalance:'åŠå¹´',action:'ä»¥è´§åŸº+çŸ­å€ºä¸ºä¸»ï¼Œç¡®ä¿æœ¬é‡‘å®‰å…¨ï¼Œé€‚åº¦é…ç½®çº¢åˆ©æŒ‡æ•°'},
  medium:{name:'ç¨³å¥å‹',bond:'40â€“60',index:'30â€“50',equity:'10â€“20',rebalance:'å­£åº¦',action:'è‚¡å€ºå¹³è¡¡ï¼Œå®šæŠ•å®½åŸºæŒ‡æ•°ï¼Œé€¢å›æ’¤åŠ ä»“'},
  high:{name:'è¿›å–å‹',bond:'20â€“40',index:'40â€“50',equity:'20â€“40',rebalance:'æœˆåº¦',action:'é«˜æ³¢åŠ¨èµ„äº§+è¡Œä¸šä¸»é¢˜åŸºé‡‘ï¼Œä¸¥æ ¼æ­¢ç›ˆæ­¢æŸ'}
};

function genReport(data){
  if(mode==='simple'){
    const {monthly,interest,firstMonth,lastMonth}=data;
    const methodText={equalInterest:'ç­‰é¢æœ¬æ¯',equalPrincipal:'ç­‰é¢æœ¬é‡‘',equalInterestPrincipal:'ç­‰æœ¬ç­‰æ¯',interestOnly:'å…ˆæ¯åæœ¬'}[data.method];
    let advice='';
    if(monthly<2500) advice='æœˆä¾›å‹åŠ›å°ï¼Œå¯ç»´æŒå½“å‰æ–¹æ¡ˆï¼ŒåŒæ—¶å‡†å¤‡6ä¸ªæœˆåº”æ€¥é‡‘ã€‚';
    else advice='æœˆä¾›åé«˜ï¼Œå»ºè®®æé«˜é¦–ä»˜æˆ–å»¶é•¿å¹´é™ï¼Œå‡è½»ç°é‡‘æµå‹åŠ›ã€‚';
    return `
      <h2>ğŸ“Š ç®€å•ç‰ˆè´·æ¬¾æŠ¥å‘Š</h2>
      <p>è¿˜æ¬¾æ–¹å¼ï¼š<strong>${methodText}</strong></p>
      <p>é¦–æœˆè¿˜æ¬¾ï¼š<strong>Â¥${firstMonth.toFixed(2)}</strong></p>
      ${data.method==='equalPrincipal'?`<p>æœ«æœˆè¿˜æ¬¾ï¼š<strong>Â¥${lastMonth.toFixed(2)}</strong></p>`:''}
      <p>æ¯æœˆè¿˜æ¬¾ï¼š<strong>${typeof monthly==='string'?monthly:`Â¥${monthly.toFixed(2)}`}</strong></p>
      <p>æ€»åˆ©æ¯ï¼š<strong>Â¥${interest.toFixed(2)}</strong></p>
      <div class="highlight">${advice}</div>
    `;
  }else{
    const {annualSave,needMonthly,realRate,income,expense,target,years,risk}=data;
    const cfg=riskMap[risk];
    const gap=needMonthly>0?`è¿˜éœ€æ¯æœˆè¿½åŠ  <strong>Â¥${needMonthly.toFixed(0)}</strong>`:'å½“å‰ç»“ä½™å·²è¶³å¤Ÿ';
    return `
      <h2>ğŸ“ˆ å¤æ‚ç‰ˆç†è´¢è§„åˆ’</h2>
      <p>ç°é‡‘æµï¼šå¹´æ”¶å…¥ <strong>Â¥${income.toLocaleString()}</strong>ï¼Œå¹´æ”¯å‡º <strong>Â¥${expense.toLocaleString()}</strong>ï¼Œå¹´åº¦å¯ç»“ä½™ <strong>Â¥${annualSave.toLocaleString()}</strong>ã€‚</p>
      <p>ç›®æ ‡ï¼š${years} å¹´åæ‹¥æœ‰ <strong>Â¥${target.toLocaleString()}</strong> è´­ä¹°åŠ›ã€‚</p>
      <p>èµ„é‡‘ç¼ºå£ï¼š${gap}ã€‚</p>
      <p>å¹´åŒ–å®é™…æ”¶ç›Šéœ€è¾¾ <strong>${(realRate*100).toFixed(2)}%</strong>ã€‚</p>
      <div class="highlight">
        <b>èµ„äº§é…ç½®ï¼ˆ${cfg.name}ï¼‰ï¼š</b><br>
        â€¢ å€ºåˆ¸/è´§åŸºï¼š${cfg.bond}%<br>
        â€¢ æŒ‡æ•°åŸºé‡‘ï¼š${cfg.index}%<br>
        â€¢ è‚¡ç¥¨/REITï¼š${cfg.equity}%<br>
        å†å¹³è¡¡å‘¨æœŸï¼š${cfg.rebalance}
      </div>
      <p><b>è¡ŒåŠ¨æ¸…å•ï¼š</b><br>
      â‘  ç«‹å³ï¼š${cfg.action}ï¼›<br>
      â‘¡ 3 ä¸ªæœˆå†…ï¼šå®Œæˆç»„åˆå»ºä»“å¹¶è®¾ç½®è‡ªåŠ¨å®šæŠ•ï¼›<br>
      â‘¢ æ¯å¹´ï¼šä¾æ®æ”¶å…¥ã€å¸‚åœºæ³¢åŠ¨é‡æ–°æµ‹ç®—å¹¶è°ƒæ•´ç›®æ ‡ã€‚
      </p>
    `;
  }
}

/* ---------- æäº¤ & åŸ‹ç‚¹ ---------- */
$('calcForm').addEventListener('submit',e=>{
  e.preventDefault();
  track('click_calc',{mode});
  const fd = Object.fromEntries(new FormData(e.target));
  Object.keys(fd).forEach(k=>fd[k]=+fd[k]||fd[k]);
  const data = mode==='simple'?calcLoan(fd.amount,fd.rate,fd.term,fd.method):calcComplex(fd);
  if(mode==='simple') data.method = fd.method;
  $('report').innerHTML = genReport(data);
  $('resultCard').classList.add('show');
  $('resultCard').classList.remove('hidden');
  if(mode==='complex') $('contactForm').classList.remove('hidden');
});

$('sendBtn').addEventListener('click',()=>{
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();
  if(!email||!phone){alert('è¯·å¡«å†™å®Œæ•´');return;}
  track('submit_lead',{mode,email_len:email.length,phone_len:phone.length});
  fetch('https://httpbin.org/post',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({email,phone})
  }).then(()=>alert('æ–¹æ¡ˆå°†åœ¨1å°æ—¶å†…å‘é€è‡³é‚®ç®±/çŸ­ä¿¡'));
});
</script>
</body>
</html>
